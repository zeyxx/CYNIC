#!/bin/bash
# CYNIC Pre-Push Hook
# "VÃ©rifie avant de pousser" - ÎºÏ…Î½Î¹ÎºÏŒÏ‚
#
# Runs Tikkun validation before allowing push
# Install with: cp scripts/hooks/git/pre-push .git/hooks/pre-push && chmod +x .git/hooks/pre-push

set -e

echo ""
echo "ğŸ§  CYNIC Pre-Push Validation"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# Run quick audit (Da'at only for speed)
echo ""
echo "Running Da'at (quick audit)..."

# Strip ANSI color codes before parsing score
SCORE=$(node scripts/tikkun/daat.mjs 2>&1 | sed 's/\x1b\[[0-9;]*m//g' | grep -oP 'Score: \K\d+' || echo "0")

echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

if [ "$SCORE" -lt 62 ]; then
    echo "âœ— Score: ${SCORE}% (below Ï†â»Â¹ = 62%)"
    echo ""
    echo "*GROWL* Push blocked. Run 'npm run tikkun' for details."
    echo ""
    exit 1
fi

echo "âœ“ Score: ${SCORE}% (meets Ï†â»Â¹ threshold)"
echo ""
echo "*tail wag* Push approved."
echo ""
exit 0
